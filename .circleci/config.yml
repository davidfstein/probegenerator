version: 2
jobs:
  build:
    machine: true
    steps:
      # Setup build directory
      - run: |
          mkdir $HOME/build
          cd $HOME/build

      # Checkout probegenerator
      - run: git clone https://$GIT_USER:$GIT_PASS@github.com/davidfstein/probegenerator.git $HOME/build/probegenerator

      # Checkout OligoMiner
      - run: git clone https://github.com/brianbeliveau/OligoMiner.git $HOME/build/OligoMiner

      # Move Dockerfile from probegenerator to /build directory
      - run: |
          cp $HOME/build/probegenerator/Dockerfile $HOME/build/Dockerfile 

      # Build and push the probe generator image
      - run: |
          TAG=0.7.$CIRCLE_BUILD_NUM
          docker build -t $DOCKER_USER/probegenerator:$TAG $HOME/build/
          docker login -u $DOCKER_USER -p $DOCKER_PASS
          docker push dstein96/probegenerator:$TAG
